function imgmap(config){this.version="2.2";this.buildDate="2009/08/12 22:18";this.buildNumber="113";this.config={};this.is_drawing=0;this.strings=[];this.memory=[];this.areas=[];this.logStore=[];this.eventHandlers={};this.currentid=0;this.draggedId=null;this.selectedId=null;this.nextShape="rect";this.viewmode=0;this.loadedScripts=[];this.isLoaded=false;this.cntReloads=0;this.mapname="";this.mapid="";this.waterMark="\x3c!-- Created by Online Image Map Editor (http://www.maschek.hu/imagemap/index) --\x3e";this.globalscale=1;this.DM_RECTANGLE_DRAW=1;this.DM_RECTANGLE_MOVE=11;this.DM_RECTANGLE_RESIZE_TOP=12;this.DM_RECTANGLE_RESIZE_RIGHT=13;this.DM_RECTANGLE_RESIZE_BOTTOM=14;this.DM_RECTANGLE_RESIZE_LEFT=15;this.DM_SQUARE_DRAW=2;this.DM_SQUARE_MOVE=21;this.DM_SQUARE_RESIZE_TOP=22;this.DM_SQUARE_RESIZE_RIGHT=23;this.DM_SQUARE_RESIZE_BOTTOM=24;this.DM_SQUARE_RESIZE_LEFT=25;this.DM_POLYGON_DRAW=3;this.DM_POLYGON_LASTDRAW=30;this.DM_POLYGON_MOVE=31;this.DM_BEZIER_DRAW=4;this.DM_BEZIER_LASTDRAW=40;this.DM_BEZIER_MOVE=41;this.config.mode="editor";this.config.baseroot="";this.config.lang="";this.config.defaultLang="en";this.config.loglevel=0;this.config.custom_callbacks={};this.event_types=["onModeChanged","onHtmlChanged","onAddArea","onRemoveArea","onDrawArea","onResizeArea","onRelaxArea","onFocusArea","onBlurArea","onMoveArea","onSelectRow","onLoadImage","onSetMap","onGetMap","onSelectArea","onDblClickArea","onStatusMessage","onAreaChanged"];this.config.CL_DRAW_BOX="#E32636";this.config.CL_DRAW_SHAPE="#d00";this.config.CL_DRAW_BG="#fff";this.config.CL_NORM_BOX="#E32636";this.config.CL_NORM_SHAPE="#d00";this.config.CL_NORM_BG="#fff";this.config.CL_HIGHLIGHT_BOX="#E32636";this.config.CL_HIGHLIGHT_SHAPE="#d00";this.config.CL_HIGHLIGHT_BG="#fff";this.config.CL_KNOB="#555";this.config.bounding_box=true;this.config.label="%n";this.config.label_class="imgmap_label";this.config.label_style="font: bold 10px Arial";this.config.hint="#%n %h";this.config.draw_opacity="35";this.config.norm_opacity="50";this.config.highlight_opacity="70";this.config.cursor_default="crosshair";var ua=navigator.userAgent;this.isMSIE=navigator.appName=="Microsoft Internet Explorer"||navigator.appName=="Netscape"&&navigator.userAgent.search("Trident")!=-1;this.isMSIE5=this.isMSIE&&ua.indexOf("MSIE 5")!=-1;this.isMSIE5_0=this.isMSIE&&ua.indexOf("MSIE 5.0")!=-1;this.isMSIE7=this.isMSIE&&ua.indexOf("MSIE 7")!=-1;this.isGecko=ua.indexOf("Gecko")!=-1;this.isSafari=ua.indexOf("Safari")!=-1;this.isOpera=typeof window.opera!="undefined";this.setup(config)}imgmap.prototype.assignOID=function(objorid){try{if(typeof objorid=="undefined"){this.log("Undefined object passed to assignOID.");return null}else if(typeof objorid=="object"){return objorid}else if(typeof objorid=="string"){return document.getElementById(objorid)}}catch(err){this.log("Error in assignOID",1)}return null};imgmap.prototype.setup=function(config){for(var i in config){if(config.hasOwnProperty(i)){this.config[i]=config[i]}}this.addEvent(document,"keydown",this.eventHandlers.doc_keydown=this.doc_keydown.bind(this));this.addEvent(document,"keyup",this.eventHandlers.doc_keyup=this.doc_keyup.bind(this));this.addEvent(document,"mousedown",this.eventHandlers.doc_mousedown=this.doc_mousedown.bind(this));if(config&&config.pic_container){this.pic_container=this.assignOID(config.pic_container);this.disableSelection(this.pic_container)}if(!this.config.baseroot){var bases=document.getElementsByTagName("base");var base="";for(i=0;i<bases.length;i++){if(bases[i].href){base=bases[i].href;if(base.charAt(base.length-1)!="/"){base+="/"}break}}var scripts=document.getElementsByTagName("script");var found=false;for(i=0;i<scripts.length;i++){if(scripts[i].src&&scripts[i].src.match(/imgmap\w*\.js(\?.*?)?$/)){var src=scripts[i].src;src=src.substring(0,src.lastIndexOf("/")+1);if(base&&src.indexOf("://")==-1){this.config.baseroot=base+src}else{this.config.baseroot=src}found=true;break}}if(!found&&this.config.baseroot===""){this.log("Unable to detect baseroot.",1)}}if(this.isMSIE&&typeof window.CanvasRenderingContext2D=="undefined"&&typeof G_vmlCanvasManager=="undefined"){this.loadScript(this.config.baseroot+"excanvas.js")}if(!this.config.lang){this.config.lang=this.detectLanguage()}if(typeof imgmapStrings=="undefined"){this.loadScript(this.config.baseroot+"lang_"+this.config.lang+".js")}var found,j,le;for(i in this.config.custom_callbacks){if(this.config.custom_callbacks.hasOwnProperty(i)){found=false;for(j=0,le=this.event_types.length;j<le;j++){if(i==this.event_types[j]){found=true;break}}if(!found){this.log("Unknown custom callback: "+i,1)}}}this.addEvent(window,"load",this.onLoad.bind(this));return true};imgmap.prototype.retryDelayed=function(fn,delay,tries){if(typeof fn.tries=="undefined"){fn.tries=0}if(fn.tries++<tries){window.setTimeout(function(){fn.apply(this)},delay)}};imgmap.prototype.onLoad=function(e){if(this.isLoaded){return true}var _this=this;if(typeof imgmapStrings=="undefined"){if(this.cntReloads++<5){window.setTimeout(function(){_this.onLoad(e)},1200);this.log("Delaying onload (language "+this.config.lang+" not loaded, try: "+this.cntReloads+")");return false}else if(this.config.lang!=this.config.defaultLang&&this.config.defaultLang!="en"){this.log("Falling back to default language: "+this.config.defaultLang);this.cntReloads=0;this.config.lang=this.config.defaultLang;this.loadScript(this.config.baseroot+"lang_"+this.config.lang+".js");window.setTimeout(function(){_this.onLoad(e)},1200);return false}else if(this.config.lang!="en"){this.log("Falling back to english language");this.cntReloads=0;this.config.lang="en";this.loadScript(this.config.baseroot+"lang_"+this.config.lang+".js");window.setTimeout(function(){_this.onLoad(e)},1200);return false}}try{this.loadStrings(imgmapStrings)}catch(err){this.log("Unable to load language strings",1)}if(this.isMSIE){if(typeof window.CanvasRenderingContext2D=="undefined"&&typeof G_vmlCanvasManager=="undefined"){this.log(this.strings.ERR_EXCANVAS_LOAD,2)}}if(this.config.mode=="highlighter"){imgmap_spawnObjects(this.config)}this.isLoaded=true;return true};imgmap.prototype.addEvent=function(obj,evt,callback){if(obj.attachEvent){return obj.attachEvent("on"+evt,callback)}else if(obj.addEventListener){obj.addEventListener(evt,callback,false);return true}else{obj["on"+evt]=callback}};imgmap.prototype.removeEvent=function(obj,evt,callback){if(obj.detachEvent){return obj.detachEvent("on"+evt,callback)}else if(obj.removeEventListener){obj.removeEventListener(evt,callback,false);return true}else{obj["on"+evt]=null}};imgmap.prototype.addLoadEvent=function(obj,callback){if(obj.attachEvent){return obj.attachEvent("onreadystatechange",callback)}else if(obj.addEventListener){obj.addEventListener("load",callback,false);return true}else{obj.onload=callback}};imgmap.prototype.loadScript=function(url){if(url===""){return false}if(this.loadedScripts[url]==1){return true}this.log("Loading script: "+url);try{var head=document.getElementsByTagName("head")[0];var temp=document.createElement("SCRIPT");temp.setAttribute("language","javascript");temp.setAttribute("type","text/javascript");temp.setAttribute("src",url);head.appendChild(temp);this.addLoadEvent(temp,this.script_load.bind(this))}catch(err){this.log("Error loading script: "+url)}return true};imgmap.prototype.script_load=function(e){var obj=this.isMSIE?window.event.srcElement:e.currentTarget;var url=obj.src;var complete=false;if(typeof obj.readyState!="undefined"){if(obj.readyState=="complete"||obj.readyState=="loaded"){complete=true}}else{complete=true}if(complete){this.loadedScripts[url]=1;this.log("Loaded script: "+url);return true}};imgmap.prototype.loadStrings=function(obj){for(var key in obj){if(obj.hasOwnProperty(key)){this.strings[key]=obj[key]}}};imgmap.prototype.loadImage=function(img,imgw,imgh){if(typeof this.pic_container=="undefined"){this.log("You must have pic_container defined to use loadImage!",2);return false}this.removeAllAreas();this.globalscale=1;this.fireEvent("onHtmlChanged","");if(!this._getLastArea()){if(this.config.mode!="editor2"){this.addNewArea()}}if(typeof img=="string"){if(typeof this.pic=="undefined"){this.pic=document.createElement("IMG");this.pic_container.appendChild(this.pic);this.addEvent(this.pic,"mousedown",this.eventHandlers.img_mousedown=this.img_mousedown.bind(this));this.addEvent(this.pic,"mouseup",this.eventHandlers.img_mouseup=this.img_mouseup.bind(this));this.addEvent(this.pic,"mousemove",this.eventHandlers.img_mousemove=this.img_mousemove.bind(this));this.pic.style.cursor=this.config.cursor_default}this.log("Loading image: "+img,0);var q="?";if(img.indexOf("?")>-1){q="&"}this.pic.src=img+q+(new Date).getTime();if(imgw&&imgw>0){this.pic.setAttribute("width",imgw)}if(imgh&&imgh>0){this.pic.setAttribute("height",imgh)}this.fireEvent("onLoadImage",this.pic);return true}else if(typeof img=="object"){var src=img.src;if(src===""&&img.getAttribute("mce_src")!==""){src=img.getAttribute("mce_src")}else if(src===""&&img.getAttribute("_fcksavedurl")!==""){src=img.getAttribute("_fcksavedurl")}if(!imgw){imgw=img.clientWidth}if(!imgh){imgh=img.clientHeight}return this.loadImage(src,imgw,imgh)}};imgmap.prototype.useImage=function(img){this.removeAllAreas();if(!this._getLastArea()){if(this.config.mode!="editor2"){this.addNewArea()}}img=this.assignOID(img);if(typeof img=="object"){if(typeof this.pic!="undefined"){this.removeEvent(this.pic,"mousedown",this.eventHandlers.img_mousedown);this.removeEvent(this.pic,"mouseup",this.eventHandlers.img_mouseup);this.removeEvent(this.pic,"mousemove",this.eventHandlers.img_mousemove);this.pic.style.cursor=""}this.pic=img;this.addEvent(this.pic,"mousedown",this.eventHandlers.img_mousedown=this.img_mousedown.bind(this));this.addEvent(this.pic,"mouseup",this.eventHandlers.img_mouseup=this.img_mouseup.bind(this));this.addEvent(this.pic,"mousemove",this.eventHandlers.img_mousemove=this.img_mousemove.bind(this));this.pic.style.cursor=this.config.cursor_default;if(this.pic.parentNode.className=="pic_container"){this.pic_container=this.pic.parentNode}else{this.pic_container=document.createElement("div");this.pic_container.className="pic_container";this.pic.parentNode.insertBefore(this.pic_container,this.pic);this.pic_container.appendChild(this.pic)}this.fireEvent("onLoadImage",this.pic);return true}};imgmap.prototype.statusMessage=function(str){this.fireEvent("onStatusMessage",str)};imgmap.prototype.log=function(obj,level){if(level===""||typeof level=="undefined"){level=0}if(this.config.loglevel!=-1&&level>=this.config.loglevel){this.logStore.push({level:level,obj:obj})}if(typeof console=="object"){console.log(obj)}else if(this.isOpera){opera.postError(level+": "+obj)}else if(typeof air=="object"){if(typeof air.Introspector=="object"){air.Introspector.Console.log(obj)}else{air.trace(obj)}}else{if(level>1){var msg="";for(var i=0,le=this.logStore.length;i<le;i++){msg+=this.logStore[i].level+": "+this.logStore[i].obj+"\n"}alert(msg)}else{window.defaultStatus=level+": "+obj}}};imgmap.prototype.getMapHTML=function(flags){var html='<map id="'+this.getMapId()+'" name="'+this.getMapName()+'">'+this.getMapInnerHTML(flags)+this.waterMark+"</map>";this.fireEvent("onGetMap",html);return html};imgmap.prototype.getMapInnerHTML=function(flags){var html,coords;html="";for(var i=0,le=this.areas.length;i<le;i++){if(this.areas[i]){if(this.areas[i].shape&&this.areas[i].shape!="undefined"){coords=this.areas[i].lastInput;if(flags&&flags.match(/noscale/)){var cs=coords.split(",");for(var j=0,le2=cs.length;j<le2;j++){cs[j]=Math.round(cs[j]*this.globalscale)}coords=cs.join(",")}html+='<area shape="'+this.areas[i].shape+'"'+' alt="'+this.areas[i].aalt+'"'+' title="'+this.areas[i].atitle+'"'+' coords="'+coords+'"'+' href="'+this.areas[i].ahref+'"'+' target="'+this.areas[i].atarget+'" />'}}}return html};imgmap.prototype.getMapName=function(){if(this.mapname===""){if(this.mapid!==""){return this.mapid}var now=new Date;this.mapname="imgmap"+now.getFullYear()+(now.getMonth()+1)+now.getDate()+now.getHours()+now.getMinutes()+now.getSeconds()}return this.mapname};imgmap.prototype.getMapId=function(){if(this.mapid===""){this.mapid=this.getMapName()}return this.mapid};imgmap.prototype._normShape=function(shape){if(!shape){return"rect"}shape=this.trim(shape).toLowerCase();if(shape.substring(0,4)=="rect"){return"rect"}if(shape.substring(0,4)=="circ"){return"circle"}if(shape.substring(0,4)=="poly"){return"poly"}return"rect"};imgmap.prototype._normCoords=function(coords,shape,flag){var i;var sx;var sy;var gx;var gy;var temp,le;coords=this.trim(coords);if(coords===""){return""}var oldcoords=coords;coords=coords.replace(/(\d)([^\d\.])+(\d)/g,"$1,$3");coords=coords.replace(/,\D+(\d)/g,",$1");coords=coords.replace(/,0+(\d)/g,",$1");coords=coords.replace(/(\d)(\D)+,/g,"$1,");coords=coords.replace(/^\D+(\d)/g,"$1");coords=coords.replace(/^0+(\d)/g,"$1");coords=coords.replace(/(\d)(\D)+$/g,"$1");var parts=coords.split(",");if(shape=="rect"){if(flag=="fromcircle"){var r=parts[2];parts[0]=parts[0]-r;parts[1]=parts[1]-r;parts[2]=parseInt(parts[0],10)+2*r;parts[3]=parseInt(parts[1],10)+2*r}else if(flag=="frompoly"){sx=parseInt(parts[0],10);gx=parseInt(parts[0],10);sy=parseInt(parts[1],10);gy=parseInt(parts[1],10);for(i=0,le=parts.length;i<le;i++){if(i%2===0&&parseInt(parts[i],10)<sx){sx=parseInt(parts[i],10)}if(i%2===1&&parseInt(parts[i],10)<sy){sy=parseInt(parts[i],10)}if(i%2===0&&parseInt(parts[i],10)>gx){gx=parseInt(parts[i],10)}if(i%2===1&&parseInt(parts[i],10)>gy){gy=parseInt(parts[i],10)}}parts[0]=sx;parts[1]=sy;parts[2]=gx;parts[3]=gy}if(!(parseInt(parts[1],10)>=0)){parts[1]=parts[0]}if(!(parseInt(parts[2],10)>=0)){parts[2]=parseInt(parts[0],10)+10}if(!(parseInt(parts[3],10)>=0)){parts[3]=parseInt(parts[1],10)+10}if(parseInt(parts[0],10)>parseInt(parts[2],10)){temp=parts[0];parts[0]=parts[2];parts[2]=temp}if(parseInt(parts[1],10)>parseInt(parts[3],10)){temp=parts[1];parts[1]=parts[3];parts[3]=temp}coords=parts[0]+","+parts[1]+","+parts[2]+","+parts[3]}else if(shape=="circle"){if(flag=="fromrect"){sx=parseInt(parts[0],10);gx=parseInt(parts[2],10);sy=parseInt(parts[1],10);gy=parseInt(parts[3],10);parts[2]=gx-sx<gy-sy?gx-sx:gy-sy;parts[2]=Math.floor(parts[2]/2);parts[0]=sx+parts[2];parts[1]=sy+parts[2]}else if(flag=="frompoly"){sx=parseInt(parts[0],10);gx=parseInt(parts[0],10);sy=parseInt(parts[1],10);gy=parseInt(parts[1],10);for(i=0,le=parts.length;i<le;i++){if(i%2===0&&parseInt(parts[i],10)<sx){sx=parseInt(parts[i],10)}if(i%2===1&&parseInt(parts[i],10)<sy){sy=parseInt(parts[i],10)}if(i%2===0&&parseInt(parts[i],10)>gx){gx=parseInt(parts[i],10)}if(i%2===1&&parseInt(parts[i],10)>gy){gy=parseInt(parts[i],10)}}parts[2]=gx-sx<gy-sy?gx-sx:gy-sy;parts[2]=Math.floor(parts[2]/2);parts[0]=sx+parts[2];parts[1]=sy+parts[2]}if(!(parseInt(parts[1],10)>0)){parts[1]=parts[0]}if(!(parseInt(parts[2],10)>0)){parts[2]=10}coords=parts[0]+","+parts[1]+","+parts[2]}else if(shape=="poly"){if(flag=="fromrect"){parts[4]=parts[2];parts[5]=parts[3];parts[2]=parts[0];parts[6]=parts[4];parts[7]=parts[1]}else if(flag=="fromcircle"){var centerX=parseInt(parts[0],10);var centerY=parseInt(parts[1],10);var radius=parseInt(parts[2],10);var j=0;parts[j++]=centerX+radius;parts[j++]=centerY;var sides=60;for(i=0;i<=sides;i++){var pointRatio=i/sides;var xSteps=Math.cos(pointRatio*2*Math.PI);var ySteps=Math.sin(pointRatio*2*Math.PI);var pointX=centerX+xSteps*radius;var pointY=centerY+ySteps*radius;parts[j++]=Math.round(pointX);parts[j++]=Math.round(pointY)}}coords=parts.join(",")}else if(shape=="bezier1"){coords=parts.join(",")}if(flag=="preserve"&&oldcoords!=coords){return oldcoords}return coords};imgmap.prototype.setMapHTML=function(map){if(this.viewmode===1){return}this.fireEvent("onSetMap",map);this.removeAllAreas();var oMap;if(typeof map=="string"){var oHolder=document.createElement("DIV");oHolder.innerHTML=map;oMap=oHolder.firstChild}else if(typeof map=="object"){oMap=map}if(!oMap||oMap.nodeName.toLowerCase()!=="map"){return false}this.mapname=oMap.name;this.mapid=oMap.id;var newareas=oMap.getElementsByTagName("area");var shape,coords,href,alt,title,target,id;for(var i=0,le=newareas.length;i<le;i++){shape=coords=href=alt=title=target="";id=this.addNewArea();shape=this._normShape(newareas[i].getAttribute("shape",2));this.initArea(id,shape);if(newareas[i].getAttribute("coords",2)){coords=this._normCoords(newareas[i].getAttribute("coords",2),shape);this.areas[id].lastInput=coords}href=newareas[i].getAttribute("href",2);var sSavedUrl=newareas[i].getAttribute("_fcksavedurl");if(sSavedUrl){href=sSavedUrl}if(href){this.areas[id].ahref=href}alt=newareas[i].getAttribute("alt");if(alt){this.areas[id].aalt=alt}title=newareas[i].getAttribute("title");if(!title){title=alt}if(title){this.areas[id].atitle=title}target=newareas[i].getAttribute("target");if(target){target=target.toLowerCase()}this.areas[id].atarget=target;this._recalculate(id,coords);this.relaxArea(id);this.fireEvent("onAreaChanged",this.areas[id])}this.fireEvent("onHtmlChanged",this.getMapHTML());return true};imgmap.prototype.togglePreview=function(){var i,le;if(!this.pic){return false}if(!this.preview){this.preview=document.createElement("DIV");this.preview.style.display="none";this.pic_container.appendChild(this.preview)}if(this.viewmode===0){for(i=0,le=this.areas.length;i<le;i++){if(this.areas[i]){this.areas[i].style.display="none";if(this.areas[i].label){this.areas[i].label.style.display="none"}}}this.preview.innerHTML=this.getMapHTML("noscale");this.pic.setAttribute("border","0",0);this.pic.setAttribute("usemap","#"+this.mapname,0);this.pic.style.cursor="auto";this.viewmode=1;this.statusMessage(this.strings.PREVIEW_MODE)}else{for(i=0,le=this.areas.length;i<le;i++){if(this.areas[i]){this.areas[i].style.display="";if(this.areas[i].label&&this.config.label){this.areas[i].label.style.display=""}}}this.preview.innerHTML="";this.pic.style.cursor=this.config.cursor_default;this.pic.removeAttribute("usemap",0);this.viewmode=0;this.statusMessage(this.strings.DESIGN_MODE);this.is_drawing=0}this.fireEvent("onModeChanged",this.viewmode);return this.viewmode};imgmap.prototype.addNewArea=function(){if(this.viewmode===1){return}var lastarea=this._getLastArea();var id=lastarea?lastarea.aid+1:0;this.areas[id]=document.createElement("DIV");this.areas[id].id=this.mapname+"area"+id;this.areas[id].aid=id;this.areas[id].shape="undefined";this.currentid=id;this.fireEvent("onAddArea",id);return id};imgmap.prototype.initArea=function(id,shape){if(!this.areas[id]){return false}if(this.areas[id].parentNode){this.areas[id].parentNode.removeChild(this.areas[id])}if(this.areas[id].label){this.areas[id].label.parentNode.removeChild(this.areas[id].label)}this.areas[id]=null;this.areas[id]=document.createElement("CANVAS");this.pic_container.appendChild(this.areas[id]);if(typeof G_vmlCanvasManager!="undefined"){this.areas[id]=G_vmlCanvasManager.initElement(this.areas[id])}this.areas[id].id=this.mapname+"area"+id;this.areas[id].aid=id;this.areas[id].shape=shape;this.areas[id].ahref="";this.areas[id].atitle="";this.areas[id].aalt="";this.areas[id].atarget="";this.areas[id].style.position="absolute";this.areas[id].style.top=this.pic.offsetTop+"px";this.areas[id].style.left=this.pic.offsetLeft+"px";this._setopacity(this.areas[id],this.config.CL_DRAW_BG,this.config.draw_opacity);this.areas[id].ondblclick=this.area_dblclick.bind(this);this.areas[id].onmousedown=this.area_mousedown.bind(this);this.areas[id].onmouseup=this.area_mouseup.bind(this);this.areas[id].onmousemove=this.area_mousemove.bind(this);this.areas[id].onmouseover=this.area_mouseover.bind(this);this.areas[id].onmouseout=this.area_mouseout.bind(this);this.memory[id]={};this.memory[id].downx=0;this.memory[id].downy=0;this.memory[id].left=0;this.memory[id].top=0;this.memory[id].width=0;this.memory[id].height=0;this.memory[id].xpoints=[];this.memory[id].ypoints=[];this.areas[id].label=document.createElement("DIV");this.pic_container.appendChild(this.areas[id].label);this.areas[id].label.className=this.config.label_class;this.assignCSS(this.areas[id].label,this.config.label_style);this.areas[id].label.style.position="absolute"};imgmap.prototype.relaxArea=function(id){if(!this.areas[id]){return}this.fireEvent("onRelaxArea",id);this._setBorder(id,"NORM");this._setopacity(this.areas[id],this.config.CL_NORM_BG,this.config.norm_opacity)};imgmap.prototype.relaxAllAreas=function(){for(var i=0,le=this.areas.length;i<le;i++){if(this.areas[i]){this.relaxArea(i)}}};imgmap.prototype._setBorder=function(id,style){if(this.areas[id].shape=="rect"||this.config.bounding_box){this.areas[id].style.borderWidth="1px";this.areas[id].style.borderStyle=style=="DRAW"?"dotted":"solid";this.areas[id].style.borderColor=this.config["CL_"+style+"_"+(this.areas[id].shape=="rect"?"SHAPE":"BOX")]}else{this.areas[id].style.border=""}};imgmap.prototype._setopacity=function(area,bgcolor,pct){if(bgcolor){area.style.backgroundColor=bgcolor}if(pct&&typeof pct=="string"&&pct.match(/^\d*\-\d+$/)){var parts=pct.split("-");if(typeof parts[0]!="undefined"){parts[0]=parseInt(parts[0],10);this._setopacity(area,bgcolor,parts[0])}if(typeof parts[1]!="undefined"){parts[1]=parseInt(parts[1],10);var curr=this._getopacity(area);var _this=this;var diff=Math.round(parts[1]-curr);if(diff>5){window.setTimeout(function(){_this._setopacity(area,null,"-"+parts[1])},20);pct=1*curr+5}else if(diff<-3){window.setTimeout(function(){_this._setopacity(area,null,"-"+parts[1])},20);pct=1*curr-3}else{pct=parts[1]}}}if(!isNaN(pct)){pct=Math.round(parseInt(pct,10));area.style.opacity=pct/100;area.style.filter="alpha(opacity="+pct+")"}};imgmap.prototype._getopacity=function(area){if(area.style.opacity<=1){return area.style.opacity*100}if(area.style.filter){return parseInt(area.style.filter.replace(/alpha\(opacity\=([^\)]*)\)/gi,"$1"),10)}return 100};imgmap.prototype.removeArea=function(id,mass){if(this.viewmode===1){return}if(id===null||typeof id=="undefined"){return}try{this.areas[id].label.parentNode.removeChild(this.areas[id].label);this.areas[id].parentNode.removeChild(this.areas[id]);this.areas[id].label.className=null;this.areas[id].label=null;this.areas[id].onmouseover=null;this.areas[id].onmouseout=null;this.areas[id].onmouseup=null;this.areas[id].onmousedown=null;this.areas[id].onmousemove=null}catch(err){}this.areas[id]=null;this.fireEvent("onRemoveArea",id);if(!mass){this.fireEvent("onHtmlChanged",this.getMapHTML())}};imgmap.prototype.removeAllAreas=function(){for(var i=0,le=this.areas.length;i<le;i++){if(this.areas[i]){this.removeArea(i,true)}}this.fireEvent("onHtmlChanged",this.getMapHTML())};imgmap.prototype.scaleAllAreas=function(scale){var rscale=1;try{rscale=scale/this.globalscale}catch(err){this.log("Invalid (global)scale",1)}this.globalscale=scale;for(var i=0,le=this.areas.length;i<le;i++){if(this.areas[i]&&this.areas[i].shape!="undefined"){this.scaleArea(i,rscale)}}};imgmap.prototype.scaleArea=function(id,rscale){this.areas[id].style.top=parseInt(this.areas[id].style.top,10)*rscale+"px";this.areas[id].style.left=parseInt(this.areas[id].style.left,10)*rscale+"px";this.setAreaSize(id,this.areas[id].width*rscale,this.areas[id].height*rscale);if(this.areas[id].shape=="poly"||this.areas[id].shape=="bezier1"){for(var i=0,le=this.areas[id].xpoints.length;i<le;i++){this.areas[id].xpoints[i]*=rscale;this.areas[id].ypoints[i]*=rscale}}this._repaint(this.areas[id],this.config.CL_NORM_SHAPE);this._updatecoords(id)};imgmap.prototype._putlabel=function(id){if(this.viewmode===1){return}if(!this.areas[id].label){return}try{if(!this.config.label){this.areas[id].label.innerHTML="";this.areas[id].label.style.display="none"}else{this.areas[id].label.style.display="";var label=this.config.label;label=label.replace(/%n/g,String(id));label=label.replace(/%c/g,String(this.areas[id].lastInput));label=label.replace(/%h/g,String(this.areas[id].ahref));label=label.replace(/%a/g,String(this.areas[id].aalt));label=label.replace(/%t/g,String(this.areas[id].atitle));this.areas[id].label.innerHTML=label}this.areas[id].label.style.top=this.areas[id].style.top;this.areas[id].label.style.left=this.areas[id].style.left}catch(err){this.log("Error putting label",1)}};imgmap.prototype._puthint=function(id){try{if(!this.config.hint){this.areas[id].title="";this.areas[id].alt=""}else{var hint=this.config.hint;hint=hint.replace(/%n/g,String(id));hint=hint.replace(/%c/g,String(this.areas[id].lastInput));hint=hint.replace(/%h/g,String(this.areas[id].ahref));hint=hint.replace(/%a/g,String(this.areas[id].aalt));hint=hint.replace(/%t/g,String(this.areas[id].atitle));this.areas[id].title=hint;this.areas[id].alt=hint}}catch(err){this.log("Error putting hint",1)}};imgmap.prototype._repaintAll=function(){for(var i=0,le=this.areas.length;i<le;i++){if(this.areas[i]){this._repaint(this.areas[i],this.config.CL_NORM_SHAPE)}}};imgmap.prototype._repaint=function(area,color,x,y){var ctx;var width,height,left,top;var i,le;if(area.shape=="circle"){width=parseInt(area.style.width,10);var radius=Math.floor(width/2)-1;if(radius<0){radius=0}ctx=area.getContext("2d");ctx.clearRect(0,0,width,width);ctx.beginPath();ctx.strokeStyle=color;ctx.arc(radius,radius,radius,0,Math.PI*2,0);ctx.stroke();ctx.closePath();ctx.strokeStyle=this.config.CL_KNOB;ctx.strokeRect(radius,radius,1,1);this._putlabel(area.aid);this._puthint(area.aid)}else if(area.shape=="rect"){this._putlabel(area.aid);this._puthint(area.aid)}else if(area.shape=="poly"){width=parseInt(area.style.width,10);height=parseInt(area.style.height,10);left=parseInt(area.style.left,10);top=parseInt(area.style.top,10);if(area.xpoints){ctx=area.getContext("2d");ctx.clearRect(0,0,width,height);ctx.beginPath();ctx.strokeStyle=color;ctx.moveTo(area.xpoints[0]-left,area.ypoints[0]-top);for(i=1,le=area.xpoints.length;i<le;i++){ctx.lineTo(area.xpoints[i]-left,area.ypoints[i]-top)}if(this.is_drawing==this.DM_POLYGON_DRAW||this.is_drawing==this.DM_POLYGON_LASTDRAW){ctx.lineTo(x-left-5,y-top-5)}ctx.lineTo(area.xpoints[0]-left,area.ypoints[0]-top);ctx.stroke();ctx.closePath()}this._putlabel(area.aid);this._puthint(area.aid)}else if(area.shape=="bezier1"){width=parseInt(area.style.width,10);height=parseInt(area.style.height,10);left=parseInt(area.style.left,10);top=parseInt(area.style.top,10);if(area.xpoints){ctx=area.getContext("2d");ctx.clearRect(0,0,width,height);ctx.beginPath();ctx.strokeStyle=color;ctx.moveTo(area.xpoints[0]-left,area.ypoints[0]-top);for(i=2,le=area.xpoints.length;i<le;i+=2){ctx.quadraticCurveTo(area.xpoints[i-1]-left,area.ypoints[i-1]-top,area.xpoints[i]-left,area.ypoints[i]-top)}if(this.is_drawing==this.DM_BEZIER_DRAW||this.is_drawing==this.DM_BEZIER_LASTDRAW){if(area.xpoints.length%2===0&&area.xpoints.length>1){ctx.quadraticCurveTo(area.xpoints[area.xpoints.length-1]-left-5,area.ypoints[area.ypoints.length-1]-top-5,x-left-5,y-top-5)}else{ctx.lineTo(x-left-5,y-top-5)}}ctx.lineTo(area.xpoints[0]-left,area.ypoints[0]-top);ctx.stroke();ctx.closePath()}this._putlabel(area.aid);this._puthint(area.aid)}};imgmap.prototype._updatecoords=function(id){var left=Math.round(parseInt(this.areas[id].style.left,10)/this.globalscale);var top=Math.round(parseInt(this.areas[id].style.top,10)/this.globalscale);var height=Math.round(parseInt(this.areas[id].style.height,10)/this.globalscale);var width=Math.round(parseInt(this.areas[id].style.width,10)/this.globalscale);var value="";if(this.areas[id].shape=="rect"){value=left+","+top+","+(left+width)+","+(top+height);this.areas[id].lastInput=value}else if(this.areas[id].shape=="circle"){var radius=Math.floor(width/2)-1;value=left+radius+","+(top+radius)+","+radius;this.areas[id].lastInput=value}else if(this.areas[id].shape=="poly"||this.areas[id].shape=="bezier1"){if(this.areas[id].xpoints){for(var i=0,le=this.areas[id].xpoints.length;i<le;i++){value+=Math.round(this.areas[id].xpoints[i]/this.globalscale)+","+Math.round(this.areas[id].ypoints[i]/this.globalscale)+","}value=value.substring(0,value.length-1)}this.areas[id].lastInput=value}this.fireEvent("onAreaChanged",this.areas[id]);this.fireEvent("onHtmlChanged",this.getMapHTML())};imgmap.prototype._recalculate=function(id,coords){try{if(coords){coords=this._normCoords(coords,this.areas[id].shape,"preserve")}else{coords=this.areas[id].lastInput||""}var parts=coords.split(",");if(this.areas[id].shape=="rect"){if(parts.length!=4||parseInt(parts[0],10)>parseInt(parts[2],10)||parseInt(parts[1],10)>parseInt(parts[3],10)){throw"invalid coords"}this.areas[id].style.left=this.globalscale*(this.pic.offsetLeft+parseInt(parts[0],10))+"px";this.areas[id].style.top=this.globalscale*(this.pic.offsetTop+parseInt(parts[1],10))+"px";this.setAreaSize(id,this.globalscale*(parts[2]-parts[0]),this.globalscale*(parts[3]-parts[1]));this._repaint(this.areas[id],this.config.CL_NORM_SHAPE)}else if(this.areas[id].shape=="circle"){if(parts.length!=3||parseInt(parts[2],10)<0){throw"invalid coords"}var width=2*parts[2];this.setAreaSize(id,this.globalscale*width,this.globalscale*width);this.areas[id].style.left=this.globalscale*(this.pic.offsetLeft+parseInt(parts[0],10)-width/2)+"px";this.areas[id].style.top=this.globalscale*(this.pic.offsetTop+parseInt(parts[1],10)-width/2)+"px";this._repaint(this.areas[id],this.config.CL_NORM_SHAPE)}else if(this.areas[id].shape=="poly"||this.areas[id].shape=="bezier1"){if(parts.length<2){throw"invalid coords"}this.areas[id].xpoints=[];this.areas[id].ypoints=[];for(var i=0,le=parts.length;i<le;i+=2){this.areas[id].xpoints[this.areas[id].xpoints.length]=this.globalscale*(this.pic.offsetLeft+parseInt(parts[i],10));this.areas[id].ypoints[this.areas[id].ypoints.length]=this.globalscale*(this.pic.offsetTop+parseInt(parts[i+1],10));this._polygongrow(this.areas[id],this.globalscale*parts[i],this.globalscale*parts[i+1])}this._polygonshrink(this.areas[id])}}catch(err){var msg=err.message?err.message:"error calculating coordinates";this.log(msg,1);this.statusMessage(this.strings.ERR_INVALID_COORDS);if(this.areas[id].lastInput){this.fireEvent("onAreaChanged",this.areas[id])}this._repaint(this.areas[id],this.config.CL_NORM_SHAPE);return}this.areas[id].lastInput=coords};imgmap.prototype._polygongrow=function(area,newx,newy){var xdiff=newx-parseInt(area.style.left,10);var ydiff=newy-parseInt(area.style.top,10);var pad=0;var pad2=0;if(newx<parseInt(area.style.left,10)){area.style.left=newx-pad+"px";this.setAreaSize(area.aid,parseInt(area.style.width,10)+Math.abs(xdiff)+pad2,null)}else if(newx>parseInt(area.style.left,10)+parseInt(area.style.width,10)){this.setAreaSize(area.aid,newx-parseInt(area.style.left,10)+pad2,null)}if(newy<parseInt(area.style.top,10)){area.style.top=newy-pad+"px";this.setAreaSize(area.aid,null,parseInt(area.style.height,10)+Math.abs(ydiff)+pad2)}else if(newy>parseInt(area.style.top,10)+parseInt(area.style.height,10)){this.setAreaSize(area.aid,null,newy-parseInt(area.style.top,10)+pad2)}};imgmap.prototype._polygonshrink=function(area){area.style.left=area.xpoints[0]+"px";area.style.top=area.ypoints[0]+"px";this.setAreaSize(area.aid,0,0);for(var i=0,le=area.xpoints.length;i<le;i++){this._polygongrow(area,area.xpoints[i],area.ypoints[i])}this._repaint(area,this.config.CL_NORM_SHAPE)};imgmap.prototype.img_mousemove=function(e){var x;var y;var xdiff;var ydiff;var diff;if(this.viewmode===1){return}var pos=this._getPos(this.pic);x=this.isMSIE?window.event.x-this.pic.offsetLeft:e.pageX-pos.x;y=this.isMSIE?window.event.y-this.pic.offsetTop:e.pageY-pos.y;x=x+this.pic_container.scrollLeft;y=y+this.pic_container.scrollTop;if(x<0||y<0||x>this.pic.width||y>this.pic.height){return}if(this.memory[this.currentid]){var top=this.memory[this.currentid].top;var left=this.memory[this.currentid].left;var height=this.memory[this.currentid].height;var width=this.memory[this.currentid].width}if(this.isSafari){if(e.shiftKey){if(this.is_drawing==this.DM_RECTANGLE_DRAW){this.is_drawing=this.DM_SQUARE_DRAW;this.statusMessage(this.strings.SQUARE2_DRAW)}}else{if(this.is_drawing==this.DM_SQUARE_DRAW&&this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_DRAW;this.statusMessage(this.strings.RECTANGLE_DRAW)}}}if(this.is_drawing==this.DM_RECTANGLE_DRAW){this.fireEvent("onDrawArea",this.currentid);xdiff=x-this.memory[this.currentid].downx;ydiff=y-this.memory[this.currentid].downy;this.setAreaSize(this.currentid,Math.abs(xdiff),Math.abs(ydiff));if(xdiff<0){this.areas[this.currentid].style.left=x+1+"px"}if(ydiff<0){this.areas[this.currentid].style.top=y+1+"px"}}else if(this.is_drawing==this.DM_SQUARE_DRAW){this.fireEvent("onDrawArea",this.currentid);xdiff=x-this.memory[this.currentid].downx;ydiff=y-this.memory[this.currentid].downy;if(Math.abs(xdiff)<Math.abs(ydiff)){diff=Math.abs(parseInt(xdiff,10))}else{diff=Math.abs(parseInt(ydiff,10))}this.setAreaSize(this.currentid,diff,diff);if(xdiff<0){this.areas[this.currentid].style.left=this.memory[this.currentid].downx+diff*-1+"px"}if(ydiff<0){this.areas[this.currentid].style.top=this.memory[this.currentid].downy+diff*-1+1+"px"}}else if(this.is_drawing==this.DM_POLYGON_DRAW||this.is_drawing==this.DM_BEZIER_DRAW){this.fireEvent("onDrawArea",this.currentid);this._polygongrow(this.areas[this.currentid],x,y)}else if(this.is_drawing==this.DM_RECTANGLE_MOVE||this.is_drawing==this.DM_SQUARE_MOVE){this.fireEvent("onMoveArea",this.currentid);x=x-this.memory[this.currentid].rdownx;y=y-this.memory[this.currentid].rdowny;if(x+width>this.pic.width||y+height>this.pic.height){return}if(x<0||y<0){return}this.areas[this.currentid].style.left=x+1+"px";this.areas[this.currentid].style.top=y+1+"px"}else if(this.is_drawing==this.DM_POLYGON_MOVE||this.is_drawing==this.DM_BEZIER_MOVE){this.fireEvent("onMoveArea",this.currentid);x=x-this.memory[this.currentid].rdownx;y=y-this.memory[this.currentid].rdowny;if(x+width>this.pic.width||y+height>this.pic.height){return}if(x<0||y<0){return}xdiff=x-left;ydiff=y-top;if(this.areas[this.currentid].xpoints){for(var i=0,le=this.areas[this.currentid].xpoints.length;i<le;i++){this.areas[this.currentid].xpoints[i]=this.memory[this.currentid].xpoints[i]+xdiff;this.areas[this.currentid].ypoints[i]=this.memory[this.currentid].ypoints[i]+ydiff}}this.areas[this.currentid].style.left=x+"px";this.areas[this.currentid].style.top=y+"px"}else if(this.is_drawing==this.DM_SQUARE_RESIZE_LEFT){this.fireEvent("onResizeArea",this.currentid);diff=x-left;if(width+-1*diff>0){this.areas[this.currentid].style.left=x+1+"px";this.areas[this.currentid].style.top=top+diff/2+"px";this.setAreaSize(this.currentid,parseInt(width+-1*diff,10),parseInt(height+-1*diff,10))}else{this.memory[this.currentid].width=0;this.memory[this.currentid].height=0;this.memory[this.currentid].left=x;this.memory[this.currentid].top=y;this.is_drawing=this.DM_SQUARE_RESIZE_RIGHT}}else if(this.is_drawing==this.DM_SQUARE_RESIZE_RIGHT){this.fireEvent("onResizeArea",this.currentid);diff=x-left-width;if(width+diff-1>0){this.areas[this.currentid].style.top=top+-1*diff/2+"px";this.setAreaSize(this.currentid,width+diff-1,height+diff)}else{this.memory[this.currentid].width=0;this.memory[this.currentid].height=0;this.memory[this.currentid].left=x;this.memory[this.currentid].top=y;this.is_drawing=this.DM_SQUARE_RESIZE_LEFT}}else if(this.is_drawing==this.DM_SQUARE_RESIZE_TOP){this.fireEvent("onResizeArea",this.currentid);diff=y-top;if(width+-1*diff>0){this.areas[this.currentid].style.top=y+1+"px";this.areas[this.currentid].style.left=left+diff/2+"px";this.setAreaSize(this.currentid,width+-1*diff,height+-1*diff)}else{this.memory[this.currentid].width=0;this.memory[this.currentid].height=0;this.memory[this.currentid].left=x;this.memory[this.currentid].top=y;this.is_drawing=this.DM_SQUARE_RESIZE_BOTTOM}}else if(this.is_drawing==this.DM_SQUARE_RESIZE_BOTTOM){this.fireEvent("onResizeArea",this.currentid);diff=y-top-height;if(width+diff-1>0){this.areas[this.currentid].style.left=left+-1*diff/2+"px";this.setAreaSize(this.currentid,width+diff-1,height+diff-1)}else{this.memory[this.currentid].width=0;this.memory[this.currentid].height=0;this.memory[this.currentid].left=x;this.memory[this.currentid].top=y;this.is_drawing=this.DM_SQUARE_RESIZE_TOP}}else if(this.is_drawing==this.DM_RECTANGLE_RESIZE_LEFT){this.fireEvent("onResizeArea",this.currentid);xdiff=x-left;if(width+-1*xdiff>0){this.areas[this.currentid].style.left=x+1+"px";this.setAreaSize(this.currentid,width+-1*xdiff,null)}else{this.memory[this.currentid].width=0;this.memory[this.currentid].left=x;this.is_drawing=this.DM_RECTANGLE_RESIZE_RIGHT}}else if(this.is_drawing==this.DM_RECTANGLE_RESIZE_RIGHT){this.fireEvent("onResizeArea",this.currentid);xdiff=x-left-width;if(width+xdiff-1>0){this.setAreaSize(this.currentid,width+xdiff-1,null)}else{this.memory[this.currentid].width=0;this.memory[this.currentid].left=x;this.is_drawing=this.DM_RECTANGLE_RESIZE_LEFT}}else if(this.is_drawing==this.DM_RECTANGLE_RESIZE_TOP){this.fireEvent("onResizeArea",this.currentid);ydiff=y-top;if(height+-1*ydiff>0){this.areas[this.currentid].style.top=y+1+"px";this.setAreaSize(this.currentid,null,height+-1*ydiff)}else{this.memory[this.currentid].height=0;this.memory[this.currentid].top=y;this.is_drawing=this.DM_RECTANGLE_RESIZE_BOTTOM}}else if(this.is_drawing==this.DM_RECTANGLE_RESIZE_BOTTOM){this.fireEvent("onResizeArea",this.currentid);ydiff=y-top-height;if(height+ydiff-1>0){this.setAreaSize(this.currentid,null,height+ydiff-1)}else{this.memory[this.currentid].height=0;this.memory[this.currentid].top=y;this.is_drawing=this.DM_RECTANGLE_RESIZE_TOP}}if(this.is_drawing){this._repaint(this.areas[this.currentid],this.config.CL_DRAW_SHAPE,x,y);this._updatecoords(this.currentid)}};imgmap.prototype.img_mouseup=function(e){if(this.viewmode===1){return}var pos=this._getPos(this.pic);var x=this.isMSIE?window.event.x-this.pic.offsetLeft:e.pageX-pos.x;var y=this.isMSIE?window.event.y-this.pic.offsetTop:e.pageY-pos.y;x=x+this.pic_container.scrollLeft;y=y+this.pic_container.scrollTop;if(this.is_drawing!=this.DM_RECTANGLE_DRAW&&this.is_drawing!=this.DM_SQUARE_DRAW&&this.is_drawing!=this.DM_POLYGON_DRAW&&this.is_drawing!=this.DM_POLYGON_LASTDRAW&&this.is_drawing!=this.DM_BEZIER_DRAW&&this.is_drawing!=this.DM_BEZIER_LASTDRAW){this.draggedId=null;this.is_drawing=0;this.statusMessage(this.strings.READY);this.relaxArea(this.currentid);if(this.areas[this.currentid]==this._getLastArea()){return}this.memory[this.currentid].downx=x;this.memory[this.currentid].downy=y}};imgmap.prototype.img_mousedown=function(e){if(this.viewmode===1){return}if(!this.areas[this.currentid]&&this.config.mode!="editor2"){return}var pos=this._getPos(this.pic);var x=this.isMSIE?window.event.x-this.pic.offsetLeft:e.pageX-pos.x;var y=this.isMSIE?window.event.y-this.pic.offsetTop:e.pageY-pos.y;x=x+this.pic_container.scrollLeft;y=y+this.pic_container.scrollTop;if(!e){e=window.event}if(e.shiftKey){if(this.is_drawing==this.DM_POLYGON_DRAW){this.is_drawing=this.DM_POLYGON_LASTDRAW}else if(this.is_drawing==this.DM_BEZIER_DRAW){this.is_drawing=this.DM_BEZIER_LASTDRAW}}if(this.is_drawing==this.DM_POLYGON_DRAW||this.is_drawing==this.DM_BEZIER_DRAW){this.areas[this.currentid].xpoints[this.areas[this.currentid].xpoints.length]=x-5;this.areas[this.currentid].ypoints[this.areas[this.currentid].ypoints.length]=y-5;this.memory[this.currentid].downx=x;this.memory[this.currentid].downy=y;return}else if(this.is_drawing&&this.is_drawing!=this.DM_POLYGON_DRAW&&this.is_drawing!=this.DM_BEZIER_DRAW){if(this.is_drawing==this.DM_POLYGON_LASTDRAW||this.is_drawing==this.DM_BEZIER_LASTDRAW){this.areas[this.currentid].xpoints[this.areas[this.currentid].xpoints.length]=x-5;this.areas[this.currentid].ypoints[this.areas[this.currentid].ypoints.length]=y-5;this._updatecoords(this.currentid);this.is_drawing=0;this._polygonshrink(this.areas[this.currentid])}this.is_drawing=0;this.statusMessage(this.strings.READY);this.relaxArea(this.currentid);if(this.areas[this.currentid]==this._getLastArea()){if(this.config.mode!="editor2"){this.addNewArea()}return}return}if(this.config.mode=="editor2"){if(!this.nextShape){return}this.addNewArea();this.initArea(this.currentid,this.nextShape)}else if(this.areas[this.currentid].shape=="undefined"||this.areas[this.currentid].shape=="poly"){var shape=this.nextShape;if(!shape){shape="rect"}this.initArea(this.currentid,shape)}if(this.areas[this.currentid].shape=="poly"){this.is_drawing=this.DM_POLYGON_DRAW;this.statusMessage(this.strings.POLYGON_DRAW);this.areas[this.currentid].style.left=x+"px";this.areas[this.currentid].style.top=y+"px";this.areas[this.currentid].style.width=0;this.areas[this.currentid].style.height=0;this.areas[this.currentid].xpoints=[];this.areas[this.currentid].ypoints=[];this.areas[this.currentid].xpoints[0]=x;this.areas[this.currentid].ypoints[0]=y}else if(this.areas[this.currentid].shape=="bezier1"){this.is_drawing=this.DM_BEZIER_DRAW;this.statusMessage(this.strings.BEZIER_DRAW);this.areas[this.currentid].style.left=x+"px";this.areas[this.currentid].style.top=y+"px";this.areas[this.currentid].style.width=0;this.areas[this.currentid].style.height=0;this.areas[this.currentid].xpoints=[];this.areas[this.currentid].ypoints=[];this.areas[this.currentid].xpoints[0]=x;this.areas[this.currentid].ypoints[0]=y}else if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_DRAW;this.statusMessage(this.strings.RECTANGLE_DRAW);this.areas[this.currentid].style.left=x+"px";this.areas[this.currentid].style.top=y+"px";this.areas[this.currentid].style.width=0;this.areas[this.currentid].style.height=0}else if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_DRAW;this.statusMessage(this.strings.SQUARE_DRAW);this.areas[this.currentid].style.left=x+"px";this.areas[this.currentid].style.top=y+"px";this.areas[this.currentid].style.width=0;this.areas[this.currentid].style.height=0}this._setBorder(this.currentid,"DRAW");this.memory[this.currentid].downx=x;this.memory[this.currentid].downy=y};imgmap.prototype.highlightArea=function(id,flag){if(this.is_drawing){return}if(this.areas[id]&&this.areas[id].shape!="undefined"){this.fireEvent("onFocusArea",this.areas[id]);this._setBorder(id,"HIGHLIGHT");var opacity=this.config.highlight_opacity;if(flag=="grad"){opacity="-"+opacity}this._setopacity(this.areas[id],this.config.CL_HIGHLIGHT_BG,opacity);this._repaint(this.areas[id],this.config.CL_HIGHLIGHT_SHAPE)}};imgmap.prototype.blurArea=function(id,flag){if(this.is_drawing){return}if(this.areas[id]&&this.areas[id].shape!="undefined"){this.fireEvent("onBlurArea",this.areas[id]);this._setBorder(id,"NORM");var opacity=this.config.norm_opacity;if(flag=="grad"){opacity="-"+opacity}this._setopacity(this.areas[id],this.config.CL_NORM_BG,opacity);this._repaint(this.areas[id],this.config.CL_NORM_SHAPE)}};imgmap.prototype.area_mousemove=function(e){if(this.viewmode===1){return}if(!this.is_drawing){var obj=this.isMSIE?window.event.srcElement:e.currentTarget;if(obj.tagName=="DIV"){obj=obj.parentNode}if(obj.tagName=="image"||obj.tagName=="group"||obj.tagName=="shape"||obj.tagName=="stroke"){obj=obj.parentNode.parentNode}if(this.isOpera){e.layerX=e.offsetX;e.layerY=e.offsetY}var xdiff=this.isMSIE?window.event.offsetX:e.layerX;var ydiff=this.isMSIE?window.event.offsetY:e.layerY;var resizable=obj.shape=="rect"||obj.shape=="circle";if(resizable&&xdiff<6&&ydiff>6){obj.style.cursor="w-resize"}else if(resizable&&xdiff>parseInt(obj.style.width,10)-6&&ydiff>6){obj.style.cursor="e-resize"}else if(resizable&&xdiff>6&&ydiff<6){obj.style.cursor="n-resize"}else if(resizable&&ydiff>parseInt(obj.style.height,10)-6&&xdiff>6){obj.style.cursor="s-resize"}else{obj.style.cursor="move"}if(obj.aid!=this.draggedId){if(obj.style.cursor=="move"){obj.style.cursor="default"}return}if(xdiff<6&&ydiff>6){if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_RESIZE_LEFT;this.statusMessage(this.strings.SQUARE_RESIZE_LEFT)}else if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_RESIZE_LEFT;this.statusMessage(this.strings.RECTANGLE_RESIZE_LEFT)}}else if(xdiff>parseInt(this.areas[this.currentid].style.width,10)-6&&ydiff>6){if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_RESIZE_RIGHT;this.statusMessage(this.strings.SQUARE_RESIZE_RIGHT)}else if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_RESIZE_RIGHT;this.statusMessage(this.strings.RECTANGLE_RESIZE_RIGHT)}}else if(xdiff>6&&ydiff<6){if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_RESIZE_TOP;this.statusMessage(this.strings.SQUARE_RESIZE_TOP)}else if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_RESIZE_TOP;this.statusMessage(this.strings.RECTANGLE_RESIZE_TOP)}}else if(ydiff>parseInt(this.areas[this.currentid].style.height,10)-6&&xdiff>6){if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_RESIZE_BOTTOM;this.statusMessage(this.strings.SQUARE_RESIZE_BOTTOM)}else if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_RESIZE_BOTTOM;this.statusMessage(this.strings.RECTANGLE_RESIZE_BOTTOM)}}else{if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_MOVE;this.statusMessage(this.strings.SQUARE_MOVE);this.memory[this.currentid].rdownx=xdiff;this.memory[this.currentid].rdowny=ydiff}else if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_MOVE;this.statusMessage(this.strings.RECTANGLE_MOVE);this.memory[this.currentid].rdownx=xdiff;this.memory[this.currentid].rdowny=ydiff}else if(this.areas[this.currentid].shape=="poly"||this.areas[this.currentid].shape=="bezier1"){if(this.areas[this.currentid].xpoints){for(var i=0,le=this.areas[this.currentid].xpoints.length;i<le;i++){this.memory[this.currentid].xpoints[i]=this.areas[this.currentid].xpoints[i];this.memory[this.currentid].ypoints[i]=this.areas[this.currentid].ypoints[i]}}if(this.areas[this.currentid].shape=="poly"){this.is_drawing=this.DM_POLYGON_MOVE;this.statusMessage(this.strings.POLYGON_MOVE)}else if(this.areas[this.currentid].shape=="bezier1"){this.is_drawing=this.DM_BEZIER_MOVE;this.statusMessage(this.strings.BEZIER_MOVE)}this.memory[this.currentid].rdownx=xdiff;this.memory[this.currentid].rdowny=ydiff}}this.memory[this.currentid].width=parseInt(this.areas[this.currentid].style.width,10);this.memory[this.currentid].height=parseInt(this.areas[this.currentid].style.height,10);this.memory[this.currentid].top=parseInt(this.areas[this.currentid].style.top,10);this.memory[this.currentid].left=parseInt(this.areas[this.currentid].style.left,10);this._setBorder(this.currentid,"DRAW");this._setopacity(this.areas[this.currentid],this.config.CL_DRAW_BG,this.config.draw_opacity)}else{this.img_mousemove(e)}};imgmap.prototype.area_mouseup=function(e){if(this.viewmode===1){return}if(!this.is_drawing){var obj=this.isMSIE?window.event.srcElement:e.currentTarget;if(obj.tagName=="DIV"){obj=obj.parentNode}if(obj.tagName=="image"||obj.tagName=="group"||obj.tagName=="shape"||obj.tagName=="stroke"){obj=obj.parentNode.parentNode}if(this.areas[this.currentid]!=obj){if(typeof obj.aid=="undefined"){this.log("Cannot identify target area",1);return}}this.draggedId=null}else{this.img_mouseup(e)}};imgmap.prototype.area_mouseover=function(e){if(this.viewmode===1&&this.config.mode!=="highlighter_spawn"){return}if(!this.is_drawing){var obj=this.isMSIE?window.event.srcElement:e.currentTarget;if(obj.tagName=="DIV"){obj=obj.parentNode}if(obj.tagName=="image"||obj.tagName=="group"||obj.tagName=="shape"||obj.tagName=="stroke"){obj=obj.parentNode.parentNode}this.highlightArea(obj.aid,"grad")}};imgmap.prototype.area_mouseout=function(e){if(this.viewmode===1&&this.config.mode!=="highlighter_spawn"){return}if(!this.is_drawing){var obj=this.isMSIE?window.event.srcElement:e.currentTarget;if(obj.tagName=="DIV"){obj=obj.parentNode}if(obj.tagName=="image"||obj.tagName=="group"||obj.tagName=="shape"||obj.tagName=="stroke"){obj=obj.parentNode.parentNode}this.blurArea(obj.aid,"grad")}};imgmap.prototype.area_dblclick=function(e){if(this.viewmode===1){return}if(!this.is_drawing){var obj=this.isMSIE?window.event.srcElement:e.currentTarget;if(obj.tagName=="DIV"){obj=obj.parentNode}if(obj.tagName=="image"||obj.tagName=="group"||obj.tagName=="shape"||obj.tagName=="stroke"){obj=obj.parentNode.parentNode}if(this.areas[this.currentid]!=obj){if(typeof obj.aid=="undefined"){this.log("Cannot identify target area",1);return}this.currentid=obj.aid}this.fireEvent("onDblClickArea",this.areas[this.currentid]);if(this.isMSIE){window.event.cancelBubble=true}else{e.stopPropagation()}}};imgmap.prototype.area_mousedown=function(e){if(this.viewmode===1&&this.config.mode!=="highlighter_spawn"){return}if(!this.is_drawing){var obj=this.isMSIE?window.event.srcElement:e.currentTarget;if(obj.tagName=="DIV"){obj=obj.parentNode}if(obj.tagName=="image"||obj.tagName=="group"||obj.tagName=="shape"||obj.tagName=="stroke"){obj=obj.parentNode.parentNode}if(this.areas[this.currentid]!=obj){if(typeof obj.aid=="undefined"){this.log("Cannot identify target area",1);return}this.currentid=obj.aid}this.draggedId=this.currentid;this.selectedId=this.currentid;this.fireEvent("onSelectArea",this.areas[this.currentid]);if(this.isMSIE){window.event.cancelBubble=true}else{e.stopPropagation()}}else{this.img_mousedown(e)}};imgmap.prototype.doc_keydown=function(e){if(this.viewmode===1){return}var key=this.isMSIE?event.keyCode:e.keyCode;if(key==46){if(this.selectedId!==null&&!this.is_drawing){this.removeArea(this.selectedId)}}else if(key==16){if(this.is_drawing==this.DM_RECTANGLE_DRAW){this.is_drawing=this.DM_SQUARE_DRAW;this.statusMessage(this.strings.SQUARE2_DRAW)}}};imgmap.prototype.doc_keyup=function(e){var key=this.isMSIE?event.keyCode:e.keyCode;if(key==16){if(this.is_drawing==this.DM_SQUARE_DRAW&&this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_DRAW;this.statusMessage(this.strings.RECTANGLE_DRAW)}}};imgmap.prototype.doc_mousedown=function(e){if(this.viewmode===1){return}if(!this.is_drawing){this.selectedId=null}};imgmap.prototype._getPos=function(element){var xpos=0;var ypos=0;if(element){var elementOffsetParent=element.offsetParent;if(elementOffsetParent){while(elementOffsetParent=element.offsetParent){if(element.offsetLeft>0){xpos+=element.offsetLeft}if(element.offsetTop>0){ypos+=element.offsetTop}element=elementOffsetParent}}else{xpos=element.offsetLeft;ypos=element.offsetTop}}return{x:xpos,y:ypos}};imgmap.prototype._getLastArea=function(){for(var i=this.areas.length-1;i>=0;i--){if(this.areas[i]){return this.areas[i]}}return null};imgmap.prototype.assignCSS=function(obj,cssText){var parts=cssText.split(";");for(var i=0;i<parts.length;i++){var p=parts[i].split(":");var pp=this.trim(p[0]).split("-");var prop=pp[0];for(var j=1;j<pp.length;j++){prop+=pp[j].replace(/^\w/,pp[j].substring(0,1).toUpperCase())}obj.style[this.trim(prop)]=this.trim(p[1])}};imgmap.prototype.fireEvent=function(evt,obj){if(typeof this.config.custom_callbacks[evt]=="function"){return this.config.custom_callbacks[evt](obj)}};imgmap.prototype.setAreaSize=function(id,w,h){if(id===null){id=this.currentid}if(w!==null){this.areas[id].width=w;this.areas[id].style.width=w+"px";this.areas[id].setAttribute("width",w)}if(h!==null){this.areas[id].height=h;this.areas[id].style.height=h+"px";this.areas[id].setAttribute("height",h)}};imgmap.prototype.detectLanguage=function(){var lang;if(navigator.userLanguage){lang=navigator.userLanguage.toLowerCase()}else if(navigator.language){lang=navigator.language.toLowerCase()}else{return this.config.defaultLang}if(lang.length>=2){lang=lang.substring(0,2);return lang}return this.config.defaultLang};imgmap.prototype.disableSelection=function(element){if(typeof element=="undefined"||!element){return false}if(typeof element.onselectstart!="undefined"){element.onselectstart=function(){return false}}if(typeof element.unselectable!="undefined"){element.unselectable="on"}if(typeof element.style.MozUserSelect!="undefined"){element.style.MozUserSelect="none"}};imgmap.prototype.trim=function(str){return str.replace(/^\s+|\s+$/g,"")};function imgmap_spawnObjects(config){var maps=document.getElementsByTagName("map");var imgs=document.getElementsByTagName("img");var imaps=[];var imapn;for(var i=0,le=maps.length;i<le;i++){for(var j=0,le2=imgs.length;j<le2;j++){if("#"+maps[i].name==imgs[j].getAttribute("usemap")){config.mode="highlighter_spawn";imapn=new imgmap(config);imapn.useImage(imgs[j]);imapn.setMapHTML(maps[i]);imapn.viewmode=1;imaps.push(imapn)}}}}